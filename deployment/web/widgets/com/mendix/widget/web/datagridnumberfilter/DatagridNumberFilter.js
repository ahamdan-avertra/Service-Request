define(["react","big.js","mendix/filters/builders"],(function(e,t,l){"use strict";var n,a={exports:{}};
/*!
  	Copyright (c) 2018 Jed Watson.
  	Licensed under the MIT License (MIT), see
  	http://jedwatson.github.io/classnames
  */n=a,function(){var e={}.hasOwnProperty;function t(){for(var l=[],n=0;n<arguments.length;n++){var a=arguments[n];if(a){var r=typeof a;if("string"===r||"number"===r)l.push(a);else if(Array.isArray(a)){if(a.length){var i=t.apply(null,a);i&&l.push(i)}}else if("object"===r){if(a.toString!==Object.prototype.toString&&!a.toString.toString().includes("[native code]")){l.push(a.toString());continue}for(var u in a)e.call(a,u)&&a[u]&&l.push(u)}}}return l.join(" ")}n.exports?(t.default=t,n.exports=t):window.classNames=t}();var r=a.exports;function i(t,l){const[n,a]=e.useState(),r=e.useCallback((()=>{a((e=>{const l=null==t?void 0:t.getBoundingClientRect();return a=l,(n=e)&&a&&n.height===a.height&&n.width===a.width&&n.bottom===a.bottom&&n.top===a.top&&n.left===a.left&&n.right===a.right?e:l;var n,a}))}),[t]);var i;return i=l?r:void 0,e.useEffect((()=>i?function(e){let t;const l=()=>{t=window.requestAnimationFrame((()=>{e(),l()}))},n=()=>window.cancelAnimationFrame(t);return l(),n}(i):void 0),[i]),n}function u(t){const l=t.defaultFilter,n=t.onChange,[a,u]=e.useState(l),[o,s]=e.useState(!1),c=e.useRef(null),d=e.useRef(null);var p,f;p=[c,d],f=()=>s(!1),e.useEffect((()=>{const e=e=>{if(Array.isArray(p)){if(p.some((t=>!t.current||t.current.contains(e.target))))return}else if(!p.current||p.current.contains(e.target))return;f()};return document.addEventListener("mousedown",e),document.addEventListener("touchstart",e),()=>{document.removeEventListener("mousedown",e),document.removeEventListener("touchstart",e)}}),[p,f]);const m=i(c.current,o),v=e.useCallback((e=>{u(e),n(e),s(!1)}),[n]);e.useEffect((()=>{u(l),n(l)}),[l,n]);const b=e.createElement("ul",{ref:d,id:"".concat(t.id,"-filter-selectors"),className:"filter-selectors",role:"menu","data-focusindex":0,style:{position:"fixed",top:null==m?void 0:m.bottom,left:null==m?void 0:m.left}},t.options.map(((l,n)=>e.createElement("li",{className:r({"filter-selected":a===l.value}),key:n,onClick:e=>{e.preventDefault(),e.stopPropagation(),v(l.value)},onKeyDown:e=>{if("Enter"===e.key||" "===e.key)e.preventDefault(),e.stopPropagation(),v(l.value);else if("Tab"===e.key&&n+1===t.options.length)e.preventDefault(),v(a);else if("Tab"===e.key&&e.shiftKey&&0===n||"Escape"===e.key){var r;e.preventDefault(),null===(r=c.current)||void 0===r||null===(r=r.querySelector("button"))||void 0===r||r.focus(),s(!1)}},role:"menuitem",tabIndex:0},e.createElement("div",{className:r("filter-icon",l.value),"aria-hidden":!0}),e.createElement("div",{className:"filter-label"},l.label))))),y=e.useCallback((()=>{s((e=>!e)),setTimeout((()=>{var e;null===(e=d.current)||void 0===e||null===(e=e.querySelector("li.filter-selected"))||void 0===e||e.focus()}),10)}),[]);return e.createElement("div",{className:"filter-selector"},e.createElement("div",{className:"filter-selector-content",ref:c},e.createElement("button",{"aria-controls":"".concat(t.id,"-filter-selectors"),"aria-expanded":o,"aria-haspopup":!0,"aria-label":t.ariaLabel,className:r("btn btn-default filter-selector-button button-icon",a),onClick:y,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),e.stopPropagation(),y())}},"Â "),o&&b))}const o=(e,t)=>{let l=null;const n=()=>{null!==l&&(clearTimeout(l),l=null)};return[function(){for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];n(),l=setTimeout((()=>e(...r)),t)},n]};function s(e){try{return new t.Big(e)}catch{return}}function c(e,t){return l=>l[e]!==t?{...l,[e]:t}:l}function d(t,l,n){const a=function(t){const l=e.useRef(t);return e.useEffect((()=>{l.current=t})),e.useCallback((function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return l.current&&l.current.apply(void 0,t)}),[])}(l),[r]=e.useState((()=>o(a,n)[0])),i=e.useRef(null),u=e.useRef(t);return e.useEffect((()=>{var e;const{current:l}=u;t.type!==l.type?(a(s(t.inputValue),t.type),null===(e=i.current)||void 0===e||e.focus()):t.inputValue!==l.inputValue&&r(s(t.inputValue),t.type),u.current=t}),[t]),[i]}const p=e.memo((function(t){var l;const{current:n}=e.useRef(t.initialFilterType);return e.createElement("div",{className:r("filter-container",t.className),"data-focusindex":null!==(l=t.tabIndex)&&void 0!==l?l:0,style:t.styles},t.adjustable&&e.createElement(u,{ariaLabel:t.screenReaderButtonCaption,id:t.id,defaultFilter:n,onChange:t.onFilterTypeClick,options:[{value:"greater",label:"Greater than"},{value:"greaterEqual",label:"Greater than or equal"},{value:"equal",label:"Equal"},{value:"notEqual",label:"Not equal"},{value:"smaller",label:"Smaller than"},{value:"smallerEqual",label:"Smaller than or equal"},{value:"empty",label:"Empty"},{value:"notEmpty",label:"Not empty"}]}),e.createElement("input",{"aria-label":t.screenReaderInputCaption,className:r("form-control",{"filter-input":t.adjustable}),disabled:t.inputDisabled,onChange:t.onInputChange,placeholder:t.placeholder,ref:t.inputRef,type:"number",value:t.inputValue}))}));function f(l){const[n,a,r]=function(t){const[l,n]=e.useState(t),[a,r]=e.useMemo((()=>[e=>n(c("inputValue",e.target.value)),e=>n(c("type",e))]),[]);return[l,a,r]}((()=>{return{inputValue:(e=l.initialFilterValue,e instanceof t.Big?e.toString():""),type:l.initialFilterType};var e})),[i]=d(n,((e,t)=>{var n;return null===(n=l.updateFilters)||void 0===n?void 0:n.call(l,e,t)}),l.inputChangeDelay);return function(t){e.useEffect((()=>{var e;void 0!==t.initialFilterValue&&(null===(e=t.updateFilters)||void 0===e||e.call(t,t.initialFilterValue,t.initialFilterType))}),[])}(l),e.createElement(p,{initialFilterType:l.initialFilterType,onFilterTypeClick:r,onInputChange:a,inputRef:i,inputValue:n.inputValue,inputDisabled:"empty"===n.type||"notEmpty"===n.type,adjustable:l.adjustable,className:l.className,id:l.id,placeholder:l.placeholder,screenReaderButtonCaption:l.screenReaderButtonCaption,screenReaderInputCaption:l.screenReaderInputCaption,styles:l.styles,tabIndex:l.tabIndex})}const m=t=>{let{className:l,bootstrapStyle:n,children:a,role:i}=t;return e.Children.count(a)>0?e.createElement("div",{className:r("alert alert-".concat(n),l),role:i},a):null};var v;m.displayName="Alert",function(e){e.STRING="string",e.NUMBER="number",e.ENUMERATION="enum",e.DATE="date",e.ASSOCIATION="association"}(v||(v={}));const b="com.mendix.widgets.web.filterable.filterContext";function y(e){if(e&&1===e.length){const[l]=e;let n="equal";switch(l.type){case">":n="greater";break;case">=":n="greaterEqual";break;case"=":n="equal";break;case"!=":n="notEqual";break;case"<":n="smaller";break;case"<=":n="smallerEqual"}if(l.value instanceof t.Big)return{type:n,value:l.value}}}function g(e){if(e)return Object.keys(e).map((t=>e[t])).filter((e=>e.type.match(/AutoNumber|Decimal|Integer|Long/)))}return function(t){const n=e.useRef("NumberFilter".concat(function(){const e="com.mendix.widgets.web.UUID";return window[e]||(window[e]=1),window[e]++}())),a=window[b],r=e.createElement(m,{bootstrapStyle:"danger"},"The Number filter widget must be placed inside the header of the Data grid 2.0 or Gallery widget."),i=e.createElement(m,{bootstrapStyle:"danger"},'The Number filter widget can\'t be used with the filters options you have selected. It requires a "Autonumber, Decimal, Integer or Long" attribute to be selected.');return(null==a?void 0:a.Consumer)?e.createElement(a.Consumer,null,(a=>{var u,o,s,c,d,p,b,h;if(!a||!a.filterDispatcher||!a.singleAttribute&&!a.multipleAttributes)return r;const{filterDispatcher:E,singleAttribute:w,multipleAttributes:C,singleInitialFilter:N,multipleInitialFilters:q}=a,I=[...w?[w]:[],...C&&null!==(u=g(C))&&void 0!==u?u:[]];if(0===I.length)return C?i:r;const T=y(N||(null==q?void 0:q[I[0].id])),F=(R=I[0].type)&&!R.match(/AutoNumber|Decimal|Integer|Long/)?"The attribute type being used for Number filter is not 'Autonumber, Decimal, Integer or Long'":null;var R;return F?e.createElement(m,{bootstrapStyle:"danger"},F):"loading"===(null===(o=t.defaultValue)||void 0===o?void 0:o.status)?null:e.createElement(f,{adjustable:t.adjustable,className:t.class,initialFilterType:null!==(s=null==T?void 0:T.type)&&void 0!==s?s:t.defaultFilter,initialFilterValue:null!==(c=null==T?void 0:T.value)&&void 0!==c?c:null===(d=t.defaultValue)||void 0===d?void 0:d.value,inputChangeDelay:t.delay,id:n.current,placeholder:null===(p=t.placeholder)||void 0===p?void 0:p.value,screenReaderButtonCaption:null===(b=t.screenReaderButtonCaption)||void 0===b?void 0:b.value,screenReaderInputCaption:null===(h=t.screenReaderInputCaption)||void 0===h?void 0:h.value,styles:t.style,tabIndex:t.tabIndex,updateFilters:(e,n)=>{var a,r;null===(a=t.valueAttribute)||void 0===a||a.setValue(e),null===(r=t.onChange)||void 0===r||r.execute();const i=null==I?void 0:I.map((t=>function(e,t,n){if(!e||!e.filterable||"empty"!==n&&"notEmpty"!==n&&!t)return;return{greater:l.greaterThan,greaterEqual:l.greaterThanOrEqual,equal:l.equals,notEqual:l.notEqual,smaller:l.lessThan,smallerEqual:l.lessThanOrEqual,empty:l.equals,notEmpty:l.notEqual}[n](l.attribute(e.id),l.literal("empty"===n||"notEmpty"===n?void 0:t))}(t,e,n))).filter((e=>void 0!==e));E({getFilterCondition:()=>i&&i.length>1?l.or(...i):null==i?void 0:i[0],filterType:v.NUMBER})}})})):r}}));
