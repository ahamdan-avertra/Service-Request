import{useState as e,useCallback as t,useEffect as n,useRef as l,createElement as r,useMemo as a,memo as i,Children as o}from"react";import{Big as u}from"big.js";import{or as s,attribute as c,literal as d,greaterThan as p,greaterThanOrEqual as f,equals as v,notEqual as m,lessThan as b,lessThanOrEqual as y}from"mendix/filters/builders";var g,h={exports:{}};
/*!
	Copyright (c) 2018 Jed Watson.
	Licensed under the MIT License (MIT), see
	http://jedwatson.github.io/classnames
*/g=h,function(){var e={}.hasOwnProperty;function t(){for(var n=[],l=0;l<arguments.length;l++){var r=arguments[l];if(r){var a=typeof r;if("string"===a||"number"===a)n.push(r);else if(Array.isArray(r)){if(r.length){var i=t.apply(null,r);i&&n.push(i)}}else if("object"===a){if(r.toString!==Object.prototype.toString&&!r.toString.toString().includes("[native code]")){n.push(r.toString());continue}for(var o in r)e.call(r,o)&&r[o]&&n.push(o)}}}return n.join(" ")}g.exports?(t.default=t,g.exports=t):window.classNames=t}();var w=h.exports;function N(l,r){const[a,i]=e(),o=t((()=>{i((e=>{const t=null==l?void 0:l.getBoundingClientRect();return r=t,(n=e)&&r&&n.height===r.height&&n.width===r.width&&n.bottom===r.bottom&&n.top===r.top&&n.left===r.left&&n.right===r.right?e:t;var n,r}))}),[l]);var u;return n((()=>u?function(e){let t;const n=()=>{t=window.requestAnimationFrame((()=>{e(),n()}))},l=()=>window.cancelAnimationFrame(t);return n(),l}(u):void 0),[u=r?o:void 0]),a}function C(a){const i=a.defaultFilter,o=a.onChange,[u,s]=e(i),[c,d]=e(!1),p=l(null),f=l(null);var v,m;n((()=>{const e=e=>{if(Array.isArray(v)){if(v.some((t=>!t.current||t.current.contains(e.target))))return}else if(!v.current||v.current.contains(e.target))return;m()};return document.addEventListener("mousedown",e),document.addEventListener("touchstart",e),()=>{document.removeEventListener("mousedown",e),document.removeEventListener("touchstart",e)}}),[v=[p,f],m=()=>d(!1)]);const b=N(p.current,c),y=t((e=>{s(e),o(e),d(!1)}),[o]);n((()=>{s(i),o(i)}),[i,o]);const g=r("ul",{ref:f,id:"".concat(a.id,"-filter-selectors"),className:"filter-selectors",role:"menu","data-focusindex":0,style:{position:"fixed",top:null==b?void 0:b.bottom,left:null==b?void 0:b.left}},a.options.map(((e,t)=>r("li",{className:w({"filter-selected":u===e.value}),key:t,onClick:t=>{t.preventDefault(),t.stopPropagation(),y(e.value)},onKeyDown:n=>{if("Enter"===n.key||" "===n.key)n.preventDefault(),n.stopPropagation(),y(e.value);else if("Tab"===n.key&&t+1===a.options.length)n.preventDefault(),y(u);else if("Tab"===n.key&&n.shiftKey&&0===t||"Escape"===n.key){var l;n.preventDefault(),null===(l=p.current)||void 0===l||null===(l=l.querySelector("button"))||void 0===l||l.focus(),d(!1)}},role:"menuitem",tabIndex:0},r("div",{className:w("filter-icon",e.value),"aria-hidden":!0}),r("div",{className:"filter-label"},e.label))))),h=t((()=>{d((e=>!e)),setTimeout((()=>{var e;null===(e=f.current)||void 0===e||null===(e=e.querySelector("li.filter-selected"))||void 0===e||e.focus()}),10)}),[]);return r("div",{className:"filter-selector"},r("div",{className:"filter-selector-content",ref:p},r("button",{"aria-controls":"".concat(a.id,"-filter-selectors"),"aria-expanded":c,"aria-haspopup":!0,"aria-label":a.ariaLabel,className:w("btn btn-default filter-selector-button button-icon",u),onClick:h,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),e.stopPropagation(),h())}},"Â "),c&&g))}const E=(e,t)=>{let n=null;const l=()=>{null!==n&&(clearTimeout(n),n=null)};return[function(){for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];l(),n=setTimeout((()=>e(...a)),t)},l]};function I(e){try{return new u(e)}catch{return}}function F(e,t){return n=>n[e]!==t?{...n,[e]:t}:n}function A(r,a,i){const o=function(e){const r=l(e);return n((()=>{r.current=e})),t((function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return r.current&&r.current.apply(void 0,t)}),[])}(a),[u]=e((()=>E(o,i)[0])),s=l(null),c=l(r);return n((()=>{var e;const{current:t}=c;r.type!==t.type?(o(I(r.inputValue),r.type),null===(e=s.current)||void 0===e||e.focus()):r.inputValue!==t.inputValue&&u(I(r.inputValue),r.type),c.current=r}),[r]),[s]}const q=i((function(e){var t;const{current:n}=l(e.initialFilterType);return r("div",{className:w("filter-container",e.className),"data-focusindex":null!==(t=e.tabIndex)&&void 0!==t?t:0,style:e.styles},e.adjustable&&r(C,{ariaLabel:e.screenReaderButtonCaption,id:e.id,defaultFilter:n,onChange:e.onFilterTypeClick,options:[{value:"greater",label:"Greater than"},{value:"greaterEqual",label:"Greater than or equal"},{value:"equal",label:"Equal"},{value:"notEqual",label:"Not equal"},{value:"smaller",label:"Smaller than"},{value:"smallerEqual",label:"Smaller than or equal"},{value:"empty",label:"Empty"},{value:"notEmpty",label:"Not empty"}]}),r("input",{"aria-label":e.screenReaderInputCaption,className:w("form-control",{"filter-input":e.adjustable}),disabled:e.inputDisabled,onChange:e.onInputChange,placeholder:e.placeholder,ref:e.inputRef,type:"number",value:e.inputValue}))}));function T(t){const[l,i,o]=function(t){const[n,l]=e(t),[r,i]=a((()=>[e=>l(F("inputValue",e.target.value)),e=>l(F("type",e))]),[]);return[n,r,i]}((()=>{return{inputValue:(e=t.initialFilterValue,e instanceof u?e.toString():""),type:t.initialFilterType};var e})),[s]=A(l,((e,n)=>{var l;return null===(l=t.updateFilters)||void 0===l?void 0:l.call(t,e,n)}),t.inputChangeDelay);return function(e){n((()=>{var t;void 0!==e.initialFilterValue&&(null===(t=e.updateFilters)||void 0===t||t.call(e,e.initialFilterValue,e.initialFilterType))}),[])}(t),r(q,{initialFilterType:t.initialFilterType,onFilterTypeClick:o,onInputChange:i,inputRef:s,inputValue:l.inputValue,inputDisabled:"empty"===l.type||"notEmpty"===l.type,adjustable:t.adjustable,className:t.className,id:t.id,placeholder:t.placeholder,screenReaderButtonCaption:t.screenReaderButtonCaption,screenReaderInputCaption:t.screenReaderInputCaption,styles:t.styles,tabIndex:t.tabIndex})}const x=e=>{let{className:t,bootstrapStyle:n,children:l,role:a}=e;return o.count(l)>0?r("div",{className:w("alert alert-".concat(n),t),role:a},l):null};var D;x.displayName="Alert",function(e){e.STRING="string",e.NUMBER="number",e.ENUMERATION="enum",e.DATE="date",e.ASSOCIATION="association"}(D||(D={}));const k="com.mendix.widgets.web.filterable.filterContext";function R(e){if(e&&1===e.length){const[t]=e;let n="equal";switch(t.type){case">":n="greater";break;case">=":n="greaterEqual";break;case"=":n="equal";break;case"!=":n="notEqual";break;case"<":n="smaller";break;case"<=":n="smallerEqual"}if(t.value instanceof u)return{type:n,value:t.value}}}function S(e){const t=l("NumberFilter".concat(function(){const e="com.mendix.widgets.web.UUID";return window[e]||(window[e]=1),window[e]++}())),n=window[k],a=r(x,{bootstrapStyle:"danger"},"The Number filter widget must be placed inside the header of the Data grid 2.0 or Gallery widget."),i=r(x,{bootstrapStyle:"danger"},'The Number filter widget can\'t be used with the filters options you have selected. It requires a "Autonumber, Decimal, Integer or Long" attribute to be selected.');return(null==n?void 0:n.Consumer)?r(n.Consumer,null,(n=>{var l,o,u,c,d,p,f,v;if(!n||!n.filterDispatcher||!n.singleAttribute&&!n.multipleAttributes)return a;const{filterDispatcher:m,singleAttribute:b,multipleAttributes:y,singleInitialFilter:g,multipleInitialFilters:h}=n,w=[...b?[b]:[],...y&&null!==(l=V(y))&&void 0!==l?l:[]];if(0===w.length)return y?i:a;const N=R(g||(null==h?void 0:h[w[0].id])),C=(E=w[0].type)&&!E.match(/AutoNumber|Decimal|Integer|Long/)?"The attribute type being used for Number filter is not 'Autonumber, Decimal, Integer or Long'":null;var E;return C?r(x,{bootstrapStyle:"danger"},C):"loading"===(null===(o=e.defaultValue)||void 0===o?void 0:o.status)?null:r(T,{adjustable:e.adjustable,className:e.class,initialFilterType:null!==(u=null==N?void 0:N.type)&&void 0!==u?u:e.defaultFilter,initialFilterValue:null!==(c=null==N?void 0:N.value)&&void 0!==c?c:null===(d=e.defaultValue)||void 0===d?void 0:d.value,inputChangeDelay:e.delay,id:t.current,placeholder:null===(p=e.placeholder)||void 0===p?void 0:p.value,screenReaderButtonCaption:null===(f=e.screenReaderButtonCaption)||void 0===f?void 0:f.value,screenReaderInputCaption:null===(v=e.screenReaderInputCaption)||void 0===v?void 0:v.value,styles:e.style,tabIndex:e.tabIndex,updateFilters:(t,n)=>{var l,r;null===(l=e.valueAttribute)||void 0===l||l.setValue(t),null===(r=e.onChange)||void 0===r||r.execute();const a=null==w?void 0:w.map((e=>j(e,t,n))).filter((e=>void 0!==e));m({getFilterCondition:()=>a&&a.length>1?s(...a):null==a?void 0:a[0],filterType:D.NUMBER})}})})):a}function V(e){if(e)return Object.keys(e).map((t=>e[t])).filter((e=>e.type.match(/AutoNumber|Decimal|Integer|Long/)))}function j(e,t,n){if(!e||!e.filterable||"empty"!==n&&"notEmpty"!==n&&!t)return;return{greater:p,greaterEqual:f,equal:v,notEqual:m,smaller:b,smallerEqual:y,empty:v,notEmpty:m}[n](c(e.id),d("empty"===n||"notEmpty"===n?void 0:t))}export{S as default};
